{% extends "lest/base.html.twig" %}

{% block head %}
	<link rel="stylesheet" href="{{ asset('assets/css/skins/skin-demo-3.css') }}">
	<link rel="stylesheet" href="{{ asset('assets/css/demos/demo-3.css') }}">	
{% endblock %}
{% block main %}
	<main class="main">
		<nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
			<div class="container">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="{{ path('home') }}">{{'Home'|trans}}</a>
					</li>
					{% if app.request.get('_route') == 'articles_category' %}
						<li class="breadcrumb-item">
							<a href="{{ path('articles') }}">{{'Shop'|capitalize|trans}}</a>
						</li>
						<li class="breadcrumb-item active" aria-current="page">{{ app.request.get('category')  |trans}}</li>
					{% endif %}
					{% if app.request.get('_route') == 'articles' %}
						<li class="breadcrumb-item active" aria-current="page">{{'Shop'|trans}}</li>
					{% endif %}
				</ol>
			</div>
			<!-- End .container -->
		</nav>
		<!-- End .breadcrumb-nav -->

		<div class="page-content">
			<div class="container">
				<div class="row">
					<div class="col-lg-9">
						<div class="toolbox">
							<div class="toolbox-left">
								<div class="toolbox-info">
									{{'Showing'|trans}}
									<span>{{ articles|length }}
										{{'of'|trans}}</span>
									{{ articles.totalItemCount }}
									Products
								</div>
								<!-- End .toolbox-info -->
							</div>
							<!-- End .toolbox-left -->

							<div class="toolbox-right">
								<div class="toolbox-sort">
									<label for="sortby">{{'Sort by'|trans}}:</label>
									<div class="select-custom">
										<select name="sortby" id="sortby" class="form-control">
											<option value="popularity" selected="selected">Most Popular</option>
											<option value="rating">Most Rated</option>
											<option value="date">Date</option>
										</select>
									</div>
								</div>
								<!-- End .toolbox-sort -->
								<div class="toolbox-layout">
									<a href="?cols=1" class="btn-layout {{ (app.request.get('cols') == '1' )? 'active': ''  }}">
										<svg width="16" height="10">
											<rect x="0" y="0" width="4" height="4"/>
											<rect x="6" y="0" width="10" height="4"/>
											<rect x="0" y="6" width="4" height="4"/>
											<rect x="6" y="6" width="10" height="4"/>
										</svg>
									</a>

									<a href="?cols=2" class="btn-layout {{ (app.request.get('cols') == '2' )? 'active': ''  }}">
										<svg width="10" height="10">
											<rect x="0" y="0" width="4" height="4"/>
											<rect x="6" y="0" width="4" height="4"/>
											<rect x="0" y="6" width="4" height="4"/>
											<rect x="6" y="6" width="4" height="4"/>
										</svg>
									</a>

									<a href="?cols=3" class="btn-layout {{ (app.request.get('cols') == '3' )? 'active': ''  }}">
										<svg width="16" height="10">
											<rect x="0" y="0" width="4" height="4"/>
											<rect x="6" y="0" width="4" height="4"/>
											<rect x="12" y="0" width="4" height="4"/>
											<rect x="0" y="6" width="4" height="4"/>
											<rect x="6" y="6" width="4" height="4"/>
											<rect x="12" y="6" width="4" height="4"/>
										</svg>
									</a>

									<a href="{{ path('articles') }}" class="btn-layout {{ (app.request.get('cols') is empty )? 'active': ''  }}">
										<svg width="22" height="10">
											<rect x="0" y="0" width="4" height="4"/>
											<rect x="6" y="0" width="4" height="4"/>
											<rect x="12" y="0" width="4" height="4"/>
											<rect x="18" y="0" width="4" height="4"/>
											<rect x="0" y="6" width="4" height="4"/>
											<rect x="6" y="6" width="4" height="4"/>
											<rect x="12" y="6" width="4" height="4"/>
											<rect x="18" y="6" width="4" height="4"/>
										</svg>
									</a>
								</div>
								<!-- End .toolbox-layout -->
							</div>
							<!-- End .toolbox-right -->
						</div>
						<!-- End .toolbox -->

						<div class="products mb-3">
							<div class="row justify-content-center">
								{% for item in articles %}
									{% include "lest/shop/_article.html.twig" %}
									{% else %}

								{% endfor %}
							</div>
							<!-- End .row -->
						</div>
						<!-- End .products -->
						<nav aria-label="Page navigation">
							{{ knp_pagination_render(articles) }}
						</nav>
					</div>
					<!-- End .col-lg-9 -->

					<aside class="col-lg-3 order-lg-first">
						<div class="sidebar sidebar-shop">
							<div class="widget widget-clean">
								<label>Filters:</label>
								<a href="#" class="sidebar-filter-clear">Clean All</a>
							</div>
							<div class="widget widget-category widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="false" aria-controls="widget-1" class="collapsed">
										Category
									</a>
								</h3>
								<!-- End .widget-title -->

								<div class="collapse show" id="widget-1" style="">
									<div class="widget-body">
										<div class="filter-items filter-items-count">
											{% for item in categories.all %}
												<div class="filter-item">
													<a href="{{path('articles_category',{category:item.slug|lower}) }}" {{ item.slug == app.request.get('category') ? 'class="active"':'' }}>{{ item.title }}</a>
													<span class="item-count">{{ item.articles|length }}</span>
												</div>
											{% endfor %}
										</div>
										<!-- End .filter-items -->
									</div>
									<!-- End .widget-body -->
								</div>
								<!-- End .collapse -->
							</div>
							<!-- End .widget widget-clean -->
							{% if app.request.get('_route') == 'articles_category' %}
								<div class="widget widget-collapsible">
									<h3 class="widget-title">
										<a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true" aria-controls="widget-1">
											{{ 'Brand' |capitalize |trans}}
										</a>
									</h3>
									<!-- End .widget-title -->

									<div class="collapse show" id="widget-1">
										<div class="widget-body">
											<div class="filter-items filter-items-count">

												{% for item in categorie.brands %}
													<div class="filter-item">
														<div class="custom-control custom-checkbox">
															<input type="checkbox" class="custom-control-input" id="cat-{{ item.name }}">
															<label class="custom-control-label" for="cat-{{ item.name }}">{{ item.name |trans}}</label>
														</div>
														<!-- End .custom-checkbox -->
														<span class="item-count">100</span>
													</div>
												{% endfor %}
											</div>
											<!-- End .filter-items -->
										</div>
										<!-- End .widget-body -->
									</div>
									<!-- End .collapse -->
								</div>
								<!-- End .category parent-->
							{% endif %}

							<div class="widget widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-5" role="button" aria-expanded="true" aria-controls="widget-5">
										Price
									</a>
								</h3>
								<!-- End .widget-title -->

								<div class="collapse show" id="widget-5">
									<div class="widget-body">
										<div class="filter-price">
											<div class="filter-price-text">
												Price Range:
												<span id="filter-price-range"></span>
											</div>
											<!-- End .filter-price-text -->

											<div id="price-slider"></div>
											<!-- End #price-slider -->
										</div>
										<!-- End .filter-price -->
									</div>
									<!-- End .widget-body -->
								</div>
								<!-- End .collapse -->
							</div>
							<!-- End .widget -->
						</div>
						<!-- End .sidebar sidebar-shop -->
					</aside>
					<!-- End .col-lg-3 -->
				</div>
				<!-- End .row -->
			</div>
			<!-- End .container -->
		</div>
		<!-- End .page-content -->
	</main>
	<!-- End .main -->
{% endblock %}

{% block javascripts %}
<script>
	$(document).ready(function(){
		//Ajoute un article au panier
		$(document).on('click','.js-btn-add',function(e){
			e.preventDefault();
			let id = $(this).data('id')
			$.ajax({
				url:"{{ path('cart_add_ajax')}}",
				method:'POST',
				type:'json',
				beforeSend:function(){
					$('.js-loader-text').text('Ajout au panier en cour ...')
					$('.js-loader').css('display','flex')
				},
				data:{
					id: id,
				},
				success:function(data){
					loadCart()
					$('.js-loader').css('display','none')
					if(data){
						//Alert success
						Swal.fire({
							position: 'top-end',
							icon: 'success',
							title: 'Le produit a été ajouté au panier.',
							showConfirmButton: false,
							timer: 2000
							})
					}else{
						Swal.fire({
							icon: 'error',
							title: 'Une erreur est survenu.',
						})
					}
				},
				error:function(){
					alert('Une erreur est survenu.')
				}
			})
		})


		//SUPPRIMER UN ARTICLE DU PANIERr
		$(document).on('click','.js-delete-cart',function(e){
			e.preventDefault();
			let id = $(this).data('id')
			$.ajax({
				url:"{{ path('cart_delete_ajax')}}",
				method:'POST',
				type:'json',
				beforeSend:function(){
					$('.js-loader-text').text('Suppression du panier en cour ...')
					$('.js-loader').css('display','flex')
				},
				data:{
					id: id,
				},
				success:function(data){
					loadCart()
					$('.js-loader').css('display','none')
					if(data){
						//Alert success
						Swal.fire({
							position: 'top-end',
							icon: 'success',
							title: 'Le produit a été retiré du panier.',
							showConfirmButton: false,
							timer: 2000
							})
					}else{
						Swal.fire({
							icon: 'error',
							title: 'Une erreur est survenu.',
						})
					}
				},
				error:function(){
					alert('Une erreur est survenu.')
				}
			})
		})
		
		//AJOUTER L'ARTICLE EN FAVORIS
		$(document).on('click','.js-add-favoris',function(e){
			e.preventDefault()
			let id = $(this).data('id')
			
			$.ajax({
				url:"{{ path('favoris_add_ajax')}}",
				method:'POST',
				type:'json',
				beforeSend:function(){
					$('.js-loader-text').text('Ajout dans la liste des favoris en en cour ...')
					$('.js-loader').css('display','flex')
				},
				data:{
					id: id,
				},
				success:function(data){
					// $().html(remove)
					$('.js-loader').css('display','none')
					if(data){
						//changer l'icon
						$('.article-'+id+' .js-favoris').attr('href',"/favoris/remove/"+ id)
						$('.article-'+id+' .js-favoris').removeClass('js-add-favoris')
						$('.article-'+id+' .js-favoris').addClass('js-remove-favoris bg-danger')
						$('.article-'+id+' .js-favoris span').addClass('bg-danger text-white').text('Retirer des favoris')
						//Alert success
						Swal.fire({
							position: 'top-end',
							icon: 'success',
							title: 'Le produit a été ajouté à la liste des  favoris.',
							showConfirmButton: false,
							timer: 2000
							})
					}else{
						Swal.fire({
							icon: 'error',
							title: 'Une erreur est survenu.',
						})
					}
				},
				error:function(){
					alert('Une erreur est survenu.')
				}
			})
		})

		//SUPPRIMER L'ARTICLE EN FAVORIS
		$(document).on('click','.js-remove-favoris',function(e){
			e.preventDefault()
			let id = $(this).data('id')
			
			$.ajax({
				url:"{{ path('favoris_remove_ajax')}}",
				method:'POST',
				type:'json',
				beforeSend:function(){
					$('.js-loader-text').text('Suppression dans la liste des favoris en en cour ...')
					$('.js-loader').css('display','flex')
				},
				data:{
					id: id,
				},
				success:function(data){
					// $().html(remove)
					$('.js-loader').css('display','none')
					if(data){
						//changer l'icon
						$('.article-'+id+' .js-favoris').attr('href',"/favoris/add/"+ id)
						$('.article-'+id+' .js-favoris').removeClass('js-remove-favoris bg-danger')
						$('.article-'+id+' .js-favoris').addClass('js-add-favoris')
						$('.article-'+id+' .js-favoris span').removeClass('bg-danger text-white').text('Ajouter aux favoris')
						//Alert success
						Swal.fire({
							position: 'top-end',
							icon: 'success',
							title: 'Le produit a été retiré de la liste des  favoris.',
							showConfirmButton: false,
							timer: 2000
							})
					}else{
						Swal.fire({
							icon: 'error',
							title: 'Une erreur est survenu.',
						})
					}
				},
				error:function(){
					alert('Une erreur est survenu.')
				}
			})
		})

		//CHARGER LE PANIER
		function loadCart(){
			$.ajax({
				url:"{{ path('cart_load') }}",
				method:"POST",
				type:'json',
				success:function(data){
					$('.js-cart-load').html(data.cart)
				}
			})
		}
	})
</script>
{% endblock %}
